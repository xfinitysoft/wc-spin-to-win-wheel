function Spin2WinWheel(){var w=this,u=document.querySelector(".wheelSVG"),d=document.querySelector(".wheel"),O=document.querySelector(".wheelOutline"),aa=document.querySelector(".wheelContainer"),B=document.querySelector(".peg"),ba=document.querySelector(".pegContainer"),Aa=document.querySelector(".mainContainer"),x=document.querySelector(".valueContainer"),ca=document.querySelector(".centerCircle"),f=document.querySelector(".toast"),da=document.querySelector(".toast p"),b,ea,fa,P,ga,Q,n,ha,ia,ja,
ka,I,y,C,la,ma,na,oa,pa,qa,R,g,q,r,l,ra,J,D=0,h,k,E,e=0,z=2,K=0,F=0,S=F,T=[],sa,ta,U,ua,L,va,wa,t,p=null,V,G=[],Ba=new Audio("media/wheel_tick.mp3"),c,A=!0,M=null,H=!1,W,xa=function(){TweenMax.set("svg",{visibility:"visible"});TweenMax.set(d,{svgOrigin:h+" "+k,x:0,y:0});TweenMax.set(B,{x:h-B.getBBox().width/2,y:k-n-B.getBBox().height/2,transformOrigin:"50% 25%",visibility:"visible"});TweenMax.set(ba,{transformOrigin:"50% 100%",scale:Q/600});TweenMax.set(Aa,{svgOrigin:h+" "+k,rotation:-90,x:0,y:0});
TweenMax.set([f],{xPercent:-50,left:"50%"});TweenMax.set("svg",{xPercent:-50,left:"50%"})},Ca=function(){if(0==r)showInitError("numSpins MUST BE GREATER THAN 0");else if(!H){if(0<c.length){A=!1;r=c.length;for(var a=0;a<c.length;a++){if(c[a]>q||0===c[a]){showInitError("Invalid destination set - please ensure the destination in spinDestinationArray is greater than 0 and less than or equal to the number of segments");f.style.backgroundColor="red";return}--c[a];c[a]=-1*c[a]*l-1080*z;z+=2}}t?createClickToSpin():
ya();showIntroText()}},Ea=function(){for(var a,m,b,c,g,v,e,f=0;f<q;f++)F=-ra,S=F+l,a=h+n*Math.cos(Math.PI*F/180),b=k+n*Math.sin(Math.PI*F/180),m=h+n*Math.cos(Math.PI*S/180),c=k+n*Math.sin(Math.PI*S/180),g="M"+h+","+k+"  L"+a+","+b+"  A"+n+","+n+" 0 0,1 "+m+","+c+"z",e=document.createElementNS("http://www.w3.org/2000/svg","g"),v=document.createElementNS("http://www.w3.org/2000/svg","path"),e.appendChild(v),d.appendChild(e),TweenMax.set(v,{rotation:f*l,svgOrigin:h+" "+k}),v.setAttributeNS(null,"d",
g),E[f]?g=E[f]:(g=E[K],K++,K==E.length&&(K=0)),v.setAttributeNS(null,"fill",g),v.setAttributeNS(null,"stroke",0),T.push({path:v,x1:a,x2:m,y1:b,y2:c});if(0<R)for(a=0;a<q;a++)m=document.createElementNS("http://www.w3.org/2000/svg","line"),m.setAttributeNS(null,"x1",h),m.setAttributeNS(null,"x2",T[a].x2),m.setAttributeNS(null,"y1",k),m.setAttributeNS(null,"y2",T[a].y2),m.setAttributeNS(null,"stroke",qa),m.setAttributeNS(null,"stroke-width",R),d.appendChild(m),TweenMax.set(m,{svgOrigin:h+" "+k,rotation:a*
l});Da()},Da=function(){for(var a=0;a<q;a++){var b=document.createElementNS("http://www.w3.org/2000/svg","g");if("image"==g[a].type){var c=document.createElementNS("http://www.w3.org/2000/svg","image");b.appendChild(c);c.setAttribute("class","wheelImage");c.setAttributeNS(null,"x",h-I/2);c.setAttributeNS(null,"y",k-n+ja);c.setAttributeNS(null,"width",I);c.setAttributeNS(null,"height",I);c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g[a].value)}else if("string"==g[a].type){var d=document.createElementNS("http://www.w3.org/2000/svg",
"text"),f,e;g[a].value.split("^").forEach(function(a,b){f=document.createTextNode(a);e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttributeNS(null,"dy",b?"1.2em":0);e.setAttributeNS(null,"x",h);e.setAttributeNS(null,"text-anchor","middle");e.appendChild(f);d.appendChild(e)});b.appendChild(d);d.setAttribute("class","wheelText");d.setAttributeNS(null,"fill",ha);d.setAttributeNS(null,"x",h);d.setAttributeNS(null,"y",k-n+ia);d.style.fontSize=ka}x.appendChild(b);TweenMax.set(b,
{svgOrigin:h+" "+k,rotation:a*l})}TweenMax.set(x,{svgOrigin:h+" "+k})},Fa=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=document.createElementNS("http://www.w3.org/2000/svg","circle");O.appendChild(a);b.setAttributeNS(null,"fill","transparent");b.setAttributeNS(null,"stroke",P);b.setAttributeNS(null,"stroke-width",ga);b.setAttributeNS(null,"cx",h);b.setAttributeNS(null,"cy",k);b.setAttributeNS(null,"r",n);a.appendChild(b);return a},Ga=function(){var a=document.createElementNS("http://www.w3.org/2000/svg",
"circle");a.setAttributeNS(null,"fill",na);a.setAttributeNS(null,"stroke",la);a.setAttributeNS(null,"stroke-width",ma);a.setAttributeNS(null,"cx",h);a.setAttributeNS(null,"cy",k);a.setAttributeNS(null,"r",pa);return a},Ha=function(){Ba.play()},Ia=function(){f.style.visibility="hidden"},za=function(){f.style.visibility="hidden";p.onclick=null;z+=2},Ja=function(){disableWheel();A&&(V=VelocityTracker.track(d,"rotation"))},N=function(a){J=D;D=Math.round(d._gsTransform.rotation/l);D!=J&&TweenMax.fromTo(B,
.2,{rotation:D>J?-35:35},{onStart:va?Ha:null,rotation:0,ease:Back.easeOut});TweenMax.set(x,{rotation:d._gsTransform.rotation})},Ka=function(){C=d._gsTransform.rotation;var a=Math.round(C%360),a=0<a?360-a:a,a=0>a?a*=-1:a;if(V&&.5>=V.getVelocity("rotation"))enableWheel(),showResult("invalidSpin");else{showResult(Math.abs(Math.round(a/l)));if(A)if(-1<r)e++;else return;else e++,y[0].vars.snap=[c[e]];VelocityTracker.untrack(d);e>=r?endGame():enableWheel()}},La=function(a){return function(b){return Math.round(b/
l)*l-a}},ya=function(){y=Draggable.create(d,{type:"rotation",bounds:{minRotation:-1E16,maxRotation:0},throwProps:!0,ease:Back.easeOut.config(.2),snap:A?La(0):[c[e]],throwResistance:0,minDuration:sa,onThrowComplete:Ka,onPress:Ia,onDrag:N,onThrowUpdate:N,overshootTolerance:1,onDragEnd:Ja})},Na=function(){H=!0;g.forEach(function(a,b){isNaN(a.probability)&&(H=!1)});H&&(c=[],r=-1==b.numSpins?1E16:parseInt(b.numSpins),Ma())},Ma=function(){var a=0;g.forEach(function(b,c){a+=b.probability});W=a;Math.ceil(a)==
W||Math.floor(a)==W?createProbabilityArray():1==confirm("Total probability: "+a+" - If you have set JSON probability values they must add up to 100")&&(TweenMax.set(aa,{autoAlpha:0}),TweenMax.set(aa,{autoAlpha:0}))};createProbabilityArray=function(){M=[];g.forEach(function(a,b){for(var c=0;c<a.probability;c++)M.push(b)})};showProbabilityError=function(){};createClickToSpin=function(){Na()&&createProbabilityArray();p?p.onclick=getTrigger():(p=d,d.onclick=getTrigger())};getTrigger=function(){return function(){H?
ThrowPropsPlugin.to(d,{throwProps:{rotation:{velocity:Math.floor(201*Math.random()+-700),end:-(l*M[Math.floor(Math.random()*M.length)])-1080*z}},onStart:za,onUpdate:N,ease:Back.easeOut.config(.2),overshootTolerance:0,onComplete:spinComplete}):ThrowPropsPlugin.to(d,{throwProps:{rotation:{velocity:Math.floor(201*Math.random()+-700),end:A?-(l*Math.floor(Math.random()*(q-0+1)+0))-1080*z:[c[e]]}},onStart:za,onUpdate:N,ease:Back.easeOut.config(.2),overshootTolerance:0,onComplete:spinComplete})}};spinComplete=
function(){C=d._gsTransform.rotation;var a=Math.round(C%360),a=0<a?360-a:a,a=0>a?a*=-1:a;showResult(Math.abs(Math.round(a/l)));if(A)if(-1<r)e++;else return;else e++;e>=r?endGame():p.onclick=getTrigger()};endGame=function(){disableWheel();TweenMax.set(u,{alpha:.3});TweenMax.to(da,1,{text:ta,ease:Linear.easeNone,delay:2});X({gameId:L,target:w,results:G})};disableWheel=function(){t||y[0].disable()};enableWheel=function(){t||y[0].enable()};showResult=function(a){t||y[0].applyBounds({minRotation:-1E16,
maxRotation:C});"invalidSpin"==a?(TweenMax.set(d,{rotation:c[e]}),showToast(U),a={target:w,type:"error",spinCount:e,win:null,msg:U,gameId:L},Y(a),G.push(a)):isNaN(a)||(showToast(g[a].resultText),a={target:w,type:"result",spinCount:e,win:g[a].win,msg:g[a].resultText,gameId:L,userData:g[a].userData},Z(a),G.push(a))};showIntroText=function(a){showToast(ua)};showInitError=function(a){TweenMax.set([u,B],{visibility:"hidden"});alert(a)};showToast=function(a){f.style.visibility="visible";f.style.backgroundColor=
"#E81D62";da.innerHTML=a;TweenMax.fromTo(f,.6,{y:20,alpha:0},{y:0,alpha:1,delay:.2,onStart:onresize,ease:Elastic.easeOut.config(.7,.7)})};checkNumSegments=function(){1>=q&&(showInitError("Not enough segments. Please add more entries to segmentValuesArray"),TweenMax.set(u,{visibility:"hidden"}),f.style.backgroundColor="red")};setSpinTrigger=function(){p&&(t=!0);t&&(p?p.onclick=getTrigger():d.onclick=getTrigger())};var Z=function(a){w.onResult(a)};var Y=function(a){w.onError(a)};var X=function(a){w.onGameEnd(a)};
this.onResult=Z;this.onError=Y;this.onGameEnd=X;this.getGameProgress=function(){return G};this.init=function(a){a?(ea=a.data.svgWidth,fa=a.data.svgHeight,u.setAttribute("viewBox","0 0 "+ea+" "+a.data.svgHeight),b=a.data,X=a.onGameEnd?a.onGameEnd:function(){},Z=a.onResult?a.onResult:function(){},Y=a.onError?a.onError:function(){},p=a.spinTrigger?a.spinTrigger:null,setSpinTrigger(),P=b.wheelStrokeColor,Q=b.wheelSize,n=Q/2,ha=b.wheelTextColor,P=b.wheelStrokeColor,ga=b.wheelStrokeWidth,ia=b.wheelTextOffsetY,
ja=b.wheelImageOffsetY,I=b.wheelImageSize,ka=b.wheelTextSize,la=b.centerCircleStrokeColor,ma=b.centerCircleStrokeWidth,na=b.centerCircleFillColor,oa=b.centerCircleSize,pa=oa/2,qa=b.segmentStrokeColor,R=b.segmentStrokeWidth,g=b.segmentValuesArray,q=g.length,r=-1==b.numSpins?1E16:parseInt(b.numSpins),sa=b.minSpinDuration,ta=b.gameOverText,U=b.invalidSpinText,ua=b.introText,va=b.hasSound,L=b.gameId,t=b.clickToSpin,l=360/q,ra=l/2,h=b.centerX,k=b.centerY,E=b.colorArray,wa=b.hasShadows,c=b.spinDestinationArray,
wa&&(O.setAttributeNS(null,"filter","url(#shadow)"),x.setAttributeNS(null,"filter","url(#shadow)"),ca.setAttributeNS(null,"filter","url(#shadow)"),ba.setAttributeNS(null,"filter","url(#shadow)"),f.style.boxShadow="0px 0px 20px rgba(21,21,21,0.5)"),xa(),Ea(),O.appendChild(Fa()),ca.appendChild(Ga()),Ca(),checkNumSegments()):(xa(),showInitError("PLEASE INCLUDE THE INIT OBJECT"))};window.onresize=function(){var a=k-fa/2;parseFloat(getComputedStyle(u).width);var b=parseFloat(getComputedStyle(u).height);
parseFloat(getComputedStyle(f).width);var c=parseFloat(getComputedStyle(f).height);TweenMax.set(".toast",{y:(b+a)/2-c/2})};this.restart=function(){t||(y[0].kill(),D=J=null,TweenMax.to([d,x],.3,{rotation:"0_short",onComplete:ya}));TweenMax.set(u,{alpha:1});TweenMax.to([d,x],.3,{rotation:"0_short"});f.style.visibility="hidden";e=0;z=2;G=[];showIntroText()}};